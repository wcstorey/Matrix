<div class="post_wrapper">
  <% if @post.parent.nil? %>
    <h3> at <%= @post.created_at %>, <%= @post.user.username%> wrote:</h3>
  <% else %>
    <h3> at <%= @post.created_at %>, <%= @post.user.username%> replied to <%= @post.parent.user.username%>:</h3>
  <% end %>
  <h2><%= @post.title %> </h2>
  <p><%= @post.content %></p>

  <div class="vote">
    <%= link_to 'Upvote', votes_path(post: @post, :page_id => params[:id]), method: 'POST' %>
  </div>
  <div class="vote">
    <%= link_to 'Downvote', vote_path(post: @post, :page_id => params[:id]), method: 'DELETE' %>
  </div>
  <div class="votecount">
    <%= @post.vote_count %>
  </div>


<% if current_user && @post.user_id == current_user.id %>
  <div class="edit_delete"><%= link_to 'edit', edit_category_post_path(@post.category, @post) %></div>
  <div class="edit_delete"><%= link_to 'delete', category_post_path(@post.category, @post, :page_id => params[:id]), :method => :delete %></div>
<% end %>

<% if current_user %>
  <%= link_to "Reply To This Post", new_category_post_path(:category_id => @category.id, :parent_id => @post.id, :page_id => params[:id])%>
<% end %>


<% @children = @post.children %>
<% @sorted_children = @children.sort_by { |child| -child.vote_count } %>
<% @sorted_children.each do |comment| %>
  <%= render partial: 'show_post_contents', :locals => { :@post => comment } %>
<% end %>
</div>
